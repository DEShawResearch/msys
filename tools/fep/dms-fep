#!/usr/bin/env desres-exec
# -*- python -*-
#{
# desres-cleanenv $DMSTOOLS_CLEANENV -- python $0 "$@"
#}

'''
dms-fep a.dms b.dms map.txt out.dms

Create an alchemical dms file from the two input files and atom mappings.
'''

import ent, dmstools

def read_map(fd):
    '''Returns dictionary giving perturbed to original (combined) mapping.
    '''
    pairs=[]
    for line in fd:
        line = line.strip()
        if line == '' or line[0] == '#': continue
        try:
            A, B = line.split()
            pairs.append((int(A), int(B)))
        except:
            'Badly formatted line in map file: <%s>' % line
            raise
    return pairs

def main():
    import optparse
    parser = optparse.OptionParser(__doc__)

    opts, args = parser.parse_args()
    if len(args)!=4: parser.error("incorrect number of arguments")

    a_name, b_name, m_name, o_name = args
    a=ent.LoadDMS(a_name)
    b=ent.LoadDMS(b_name)
    m=read_map(file(m_name))
    
    dmstools.MakeAlchemical(a, b, m)

    ent.SaveDMS(a, o_name)

if __name__=="__main__": exit(main())

# vim: filetype=python
