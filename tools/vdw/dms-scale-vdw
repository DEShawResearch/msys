#!/usr/bin/env desres-exec
#{
# desres-cleanenv $MSYS_CLEANENV -- python $0 "$@"
#}

'''
dms-scale-vdw input.dms output.dms [ options ]

Scale vdw interactions between selected atoms.

Restrictions: produces a nonbonded_scaled_param table and therefore
              may not be usable on older Anton software versions.
 
              Works for vdw_funct=vdw_12_6 only.
'''

import msys, sys
from msys import vdw

def main():
    import optparse
    parser = optparse.OptionParser(__doc__)

    parser.add_option('-s', '--scale', type='float', 
            help='scale factor for sigma')
    parser.add_option('-l', '--ligand', action='append', 
            help='atom selection for a ligand')

    opts, args = parser.parse_args()
    if len(args)!=2:
        parser.error("incorrect number of arguments")

    n=len(opts.ligand)
    if n<2:
        parser.error("need at least 2 ligand selections")
    print "got scale %s" % opts.scale

    ifile, ofile = args
    print "Loading DMS file <%s>" % ifile
    mol=msys.LoadDMS(ifile)

    for i in range(0,n):
        s1 = mol.select(opts.ligand[i])
        for j in range(i+1,n):
            s2 = mol.select(opts.ligand[j])
            vdw.Scale(mol, s1, s2, opts.scale)

    mol.coalesceTables()
    mol = mol.clone()
    print "Writing DMS file <%s>" % ofile
    msys.SaveDMS(mol, ofile)

if __name__=="__main__": main()

# vim: filetype=python
