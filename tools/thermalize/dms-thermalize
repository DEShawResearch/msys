#!/usr/bin/env desres-exec
# -*- python -*-
#{
# desres-cleanenv -m numpy/1.6.2-31A/lib-python \
# -- python $0 "$@" 
#}

'''
dms-thermalize input.dms output.dms [ options ]

Assign Boltzmann-sampled velocities to the atoms.  Atoms with zero mass
will get zero velocity.

'''

import sys, os
sys.path.insert(0,os.path.join(os.path.dirname(__file__),'..','lib','python'))

import msys
from msys import thermalize

def main():
    import optparse
    parser = optparse.OptionParser(__doc__)
    parser.add_option('-t', '--temperature', type='float', default=300, 
            help="thermalization temperature in Kelvin")
    parser.add_option('-s', '--seed', default='1',
            help="Random seed, or 'random' to get a random random seed")
    parser.add_option('--remove-drift', action='store_true', default=True,
            help="Remove center of mass motion from assigned velocities")
    parser.add_option('--no-remove-drift', action='store_false',
            dest='remove_drift',
            help="Do not remove center of mass motion from assigned velocities")

        
    opts, args = parser.parse_args()
    if len(args)!=2:
        parser.error("incorrect number of arguments")

    print "Loading input file <%s>" % args[0]
    mol=msys.LoadDMS(args[0])

    print "Thermalizing to %sK using seed %s" % (
            opts.temperature, opts.seed)

    seed=opts.seed
    if seed=='random':
        seed=None
    else:
        seed=int(seed)

    thermalize.apply(mol, opts.temperature, seed)

    if opts.remove_drift:
        print "Removing center of mass motion"
        thermalize.remove_drift(mol)

    print "Writing DMS file <%s>" % args[1]
    msys.SaveDMS(mol,args[1])

if __name__=="__main__": exit(main())

# vim: filetype=python
