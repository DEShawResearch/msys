#!/usr/bin/env desres-exec
# -*- python -*-
#{
# desres-cleanenv $MSYS_CLEANENV -- python $0 "$@"
#}

'''
dms-info [ options ] [ dms files ]

Write information about a dms file to stdout.

'''

import sys
import msys

def print_info(mol):
    alc=[a for a in mol.atoms if a.alchemical]
    print "%12s: %8d (%4d alchemical)" % ("Atoms", mol.natoms, len(alc))
    print "%12s: %8d" % ("Bonds", mol.nbonds)
    print "%12s: %8d" % ("Residues", mol.nresidues)
    print "%12s: %8d" % ("Chains", mol.nchains)
    print "%12s: %s"  % ("Global cell", mol.cell[0])
    print "%12s  %s"  % ("", mol.cell[1])
    print "%12s  %s"  % ("", mol.cell[2])
    
    tdict=dict()
    for table in mol.tables:
        tdict.setdefault(table.category, []).append(table)

    for cat in sorted(tdict.keys()):
        tables = tdict[cat]
        title="%s tables" % cat
        print "\n%s Tables:" % cat.title()

        for table in tables:
            nalc=0
            if table.alchemical:
                for t in table.terms:
                    if t.alchemical:
                        nalc += 1
            print "%18s: %d sites, %6d params, %6d terms, %2d alchemical" % (
                    table.name, table.natoms, len(table.params), 
                    table.nterms-nalc, nalc)

    print
    for sel, title in (
            ('protein', 'Protein'),
            ('lipid', 'Lipid'),
            ('ions', 'Ions'),
            ('water', 'Water'),
            ('not (protein or lipid or ions or water)', 'Other')):

        atoms=mol.atomselect(sel)
        residues=set(a.residue for a in atoms)
        chains=set(r.chain for r in residues)
        print "%12s: %8d atoms, %8d residues, %8d chains" % (
                title, len(atoms), len(residues), len(chains))


def main():
    import optparse
    parser = optparse.OptionParser(__doc__)

    opts, args = parser.parse_args()
    for path in args:
        mol = msys.LoadDMS(path)
        print path
        print_info(mol)
        print "-" * 75

if __name__=="__main__": exit(main())

# vim: filetype=python
